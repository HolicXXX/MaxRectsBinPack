var mr;!function(t){function e(t,e,i,h){this.x=t||0,this.y=e||0,this.width=i||0,this.height=h||0}e.prototype={constructor:e,clone:function(){return new e(this.x,this.y,this.width,this.height)}},e.isContainedIn=function(t,e){return t.x>=e.x&&t.y>=e.y&&t.x+t.width<=e.x+e.width&&t.y+t.height<=e.y+e.height},t.Rect=e,egret.registerClass(e,"mr.Rect");function i(t,e,i){this.binWidth=0,this.binHeight=0,this.allowRotate=!1,this.usedRectangles=[],this.freeRectangles=[],this.init(t,e,i)}i.prototype={constructor:i,init:function(t,i,h){this.binWidth=t,this.binHeight=i,this.allowRotate=h||!1,this.usedRectangles.length=0,this.freeRectangles.length=0,this.freeRectangles.push(new e(0,0,t,i))},insert:function(t,i,h){var a=new e,n={value:0},s={value:0};switch(h=h||0){case 0:a=this._findPositionForNewNodeBestShortSideFit(t,i,n,s);break;case 3:a=this._findPositionForNewNodeBottomLeft(t,i,n,s);break;case 4:a=this._findPositionForNewNodeContactPoint(t,i,n);break;case 1:a=this._findPositionForNewNodeBestLongSideFit(t,i,s,n);break;case 2:a=this._findPositionForNewNodeBestAreaFit(t,i,n,s)}return 0===a.height?a:(this._placeRectangle(a),a)},insert2:function(t,i){for(var h=[];t.length>0;){for(var a=1/0,n=1/0,s=-1,o=new e,r=0;r<t.length;r++){var l={value:0},u={value:0},d=this._scoreRectangle(t[r].width,t[r].height,i,l,u);(l.value<a||l.value==a&&u.value<n)&&(a=l.value,n=u.value,o=d,s=r)}if(-1==s)return h;this._placeRectangle(o);var g=t.splice(s,1)[0];g.x=o.x,g.y=o.y,h.push(g)}return h},_placeRectangle:function(t){for(var e=this.freeRectangles.length,i=0;i<e;i++)this._splitFreeNode(this.freeRectangles[i],t)&&(this.freeRectangles.splice(i,1),i--,e--);this._pruneFreeList(),this.usedRectangles.push(t)},_scoreRectangle:function(t,i,h,a,n){var s=new e;switch(a.value=1/0,n.value=1/0,h){case 0:s=this._findPositionForNewNodeBestShortSideFit(t,i,a,n);break;case 3:s=this._findPositionForNewNodeBottomLeft(t,i,a,n);break;case 4:s=this._findPositionForNewNodeContactPoint(t,i,a),a=-a;break;case 1:s=this._findPositionForNewNodeBestLongSideFit(t,i,n,a);break;case 2:s=this._findPositionForNewNodeBestAreaFit(t,i,a,n)}return 0===s.height&&(a.value=1/0,n.value=1/0),s},_occupancy:function(){for(var t=this.usedRectangles,e=0,i=0;i<t.length;i++)e+=t[i].width*t[i].height;return e/(this.binWidth*this.binHeight)},_findPositionForNewNodeBottomLeft:function(t,i,h,a){var n,s,o=this.freeRectangles,r=new e;h.value=1/0;for(var l=0;l<o.length;l++)(n=o[l]).width>=t&&n.height>=i&&((s=n.y+i)<h.value||s==h.value&&n.x<a.value)&&(r.x=n.x,r.y=n.y,r.width=t,r.height=i,h.value=s,a.value=n.x),this.allowRotate&&n.width>=i&&n.height>=t&&((s=n.y+t)<h.value||s==h.value&&n.x<a.value)&&(r.x=n.x,r.y=n.y,r.width=i,r.height=t,h.value=s,a.value=n.x);return r},_findPositionForNewNodeBestShortSideFit:function(t,i,h,a){var n,s,o,r,l,u=this.freeRectangles,d=new e;h.value=1/0;for(var g=0;g<u.length;g++){var c,v,w,x;(n=u[g]).width>=t&&n.height>=i&&(s=Math.abs(n.width-t),o=Math.abs(n.height-i),r=Math.min(s,o),l=Math.max(s,o),(r<h.value||r==h.value&&l<a.value)&&(d.x=n.x,d.y=n.y,d.width=t,d.height=i,h.value=r,a.value=l)),this.allowRotate&&n.width>=i&&n.height>=t&&(c=Math.abs(n.width-i),v=Math.abs(n.height-t),w=Math.min(c,v),x=Math.max(c,v),(w<h.value||w==h.value&&x<a.value)&&(d.x=n.x,d.y=n.y,d.width=i,d.height=t,h.value=w,a.value=x))}return d},_findPositionForNewNodeBestLongSideFit:function(t,i,h,a){var n,s,o,r,l,u=this.freeRectangles,d=new e;a.value=1/0;for(var g=0;g<u.length;g++)(n=u[g]).width>=t&&n.height>=i&&(s=Math.abs(n.width-t),o=Math.abs(n.height-i),r=Math.min(s,o),((l=Math.max(s,o))<a.value||l==a.value&&r<h.value)&&(d.x=n.x,d.y=n.y,d.width=t,d.height=i,h.value=r,a.value=l)),this.allowRotate&&n.width>=i&&n.height>=t&&(s=Math.abs(n.width-i),o=Math.abs(n.height-t),r=Math.min(s,o),((l=Math.max(s,o))<a.value||l==a.value&&r<h.value)&&(d.x=n.x,d.y=n.y,d.width=i,d.height=t,h.value=r,a.value=l));return d},_findPositionForNewNodeBestAreaFit:function(t,i,h,a){var n,s,o,r,l,u=this.freeRectangles,d=new e;h.value=1/0;for(var g=0;g<u.length;g++)l=(n=u[g]).width*n.height-t*i,n.width>=t&&n.height>=i&&(s=Math.abs(n.width-t),o=Math.abs(n.height-i),r=Math.min(s,o),(l<h.value||l==h.value&&r<a.value)&&(d.x=n.x,d.y=n.y,d.width=t,d.height=i,a.value=r,h=l)),this.allowRotate&&n.width>=i&&n.height>=t&&(s=Math.abs(n.width-i),o=Math.abs(n.height-t),r=Math.min(s,o),(l<h.value||l==h.value&&r<a.value)&&(d.x=n.x,d.y=n.y,d.width=i,d.height=t,a.value=r,h.value=l));return d},_commonIntervalLength:function(t,e,i,h){return e<i||h<t?0:Math.min(e,h)-Math.max(t,i)},_contactPointScoreNode:function(t,e,i,h){var a,n=this.usedRectangles,s=0;0!=t&&t+i!==this.binWidth||(s+=h),0!=e&&e+h!==this.binHeight||(s+=i);for(var o=0;o<n.length;o++)(a=n[o]).x!=t+i&&a.x+a.width!=t||(s+=this._commonIntervalLength(a.y,a.y+a.height,e,e+h)),a.y!=e+h&&a.y+a.height!=e||(s+=this._commonIntervalLength(a.x,a.x+a.width,t,t+i));return s},_findPositionForNewNodeContactPoint:function(t,i,h){var a,n,s=this.freeRectangles,o=new e;h.value=-1;for(var r=0;r<s.length;r++)(a=s[r]).width>=t&&a.height>=i&&(n=this._contactPointScoreNode(a.x,a.y,t,i))>h.value&&(o.x=a.x,o.y=a.y,o.width=t,o.height=i,h=n),this.allowRotate&&a.width>=i&&a.height>=t&&(n=this._contactPointScoreNode(a.x,a.y,i,t))>h.value&&(o.x=a.x,o.y=a.y,o.width=i,o.height=t,h.value=n);return o},_splitFreeNode:function(t,e){var i,h=this.freeRectangles;return!(e.x>=t.x+t.width||e.x+e.width<=t.x||e.y>=t.y+t.height||e.y+e.height<=t.y)&&(e.x<t.x+t.width&&e.x+e.width>t.x&&(e.y>t.y&&e.y<t.y+t.height&&((i=t.clone()).height=e.y-i.y,h.push(i)),e.y+e.height<t.y+t.height&&((i=t.clone()).y=e.y+e.height,i.height=t.y+t.height-(e.y+e.height),h.push(i))),e.y<t.y+t.height&&e.y+e.height>t.y&&(e.x>t.x&&e.x<t.x+t.width&&((i=t.clone()).width=e.x-i.x,h.push(i)),e.x+e.width<t.x+t.width&&((i=t.clone()).x=e.x+e.width,i.width=t.x+t.width-(e.x+e.width),h.push(i))),!0)},_pruneFreeList:function(){for(var t=this.freeRectangles,i=0;i<t.length;i++)for(var h=i+1;h<t.length;h++){if(e.isContainedIn(t[i],t[h])){t.splice(i,1);break}e.isContainedIn(t[h],t[i])&&t.splice(h,1)}}},t.MaxRectsBinPack=i,egret.registerClass(i,"mr.MaxRectsBinPack"),window.MaxRectsBinPack=i}(mr||(mr={}));